
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>水曜日 朝 - ハイエース</title>
            <style>
                #map {
                    height: 800px;
                    width: 100%;
                }
                #info {
                    padding: 10px;
                    background-color: #f5f5f5;
                    margin-bottom: 10px;
                }
            </style>
        </head>
        <body>
            <div id="info">
                <h2>水曜日 朝 - ハイエース</h2>
                <p>運転手: 山田太郎</p>
                <p>同乗スタッフ: 佐藤花子</p>
            </div>
            
            <div id="map"></div>
            
            <script>
                // Google Maps APIのコールバック関数
                function initMap() {
                    const directionsService = new google.maps.DirectionsService();
                    const directionsRenderer = new google.maps.DirectionsRenderer({
                        suppressMarkers: true
                    });
                    
                    // マップの初期化
                    const map = new google.maps.Map(document.getElementById("map"), {
                        zoom: 12,
                        center: { lat: 35.6895, lng: 139.6917 }, // 東京
                    });
                    
                    directionsRenderer.setMap(map);
                    
                    // マーカー情報とアドレス
                    const markerInfo = [{"address": "\u6771\u4eac\u90fd\u8c4a\u5cf6\u533a\u6771\u6c60\u888b1-1-1", "label": "1", "title": "\u65bd\u8a2d", "icon": "https://maps.google.com/mapfiles/ms/icons/red-dot.png"}, {"address": "\u6771\u4eac\u90fd\u7df4\u99ac\u533a\u5149\u304c\u4e181-1-1", "label": "2", "title": "\u52a0\u85e4\u88d5\u5b50", "icon": "https://maps.google.com/mapfiles/ms/icons/blue-dot.png"}, {"address": "\u6771\u4eac\u90fd\u6749\u4e26\u533a\u837b\u7aaa1-1-1", "label": "3", "title": "\u5409\u7530\u667a\u4e5f", "icon": "https://maps.google.com/mapfiles/ms/icons/blue-dot.png"}, {"address": "\u6771\u4eac\u90fd\u65b0\u5bbf\u533a\u897f\u65b0\u5bbf1-1-1", "label": "4", "title": "\u4f50\u3005\u6728\u5e78\u5b50", "icon": "https://maps.google.com/mapfiles/ms/icons/blue-dot.png"}];
                    const addresses = markerInfo.map(m => m.address);
                    
                    // ジオコーディングを行う関数
                    const geocoder = new google.maps.Geocoder();
                    const geocodePromises = [];
                    
                    // 各アドレスのジオコーディングを非同期で実行
                    const geocodeAddress = (address, index) => {
                        return new Promise((resolve, reject) => {
                            geocoder.geocode({ 'address': address }, (results, status) => {
                                if (status === 'OK') {
                                    resolve({ index: index, location: results[0].geometry.location });
                                } else {
                                    console.error('Geocode failed: ' + status + ' for address: ' + address);
                                    // エラーの場合は東京駅の座標をデフォルトとして使用
                                    resolve({ index: index, location: { lat: 35.6812, lng: 139.7671 } });
                                }
                            });
                        });
                    };
                    
                    // 全てのアドレスをジオコーディング
                    addresses.forEach((address, index) => {
                        geocodePromises.push(geocodeAddress(address, index));
                    });
                    
                    // 全てのジオコーディングが完了したら
                    Promise.all(geocodePromises).then(locations => {
                        // マーカーの配置
                        locations.forEach(loc => {
                            const idx = loc.index;
                            const markerData = markerInfo[idx];
                            // ここで正しい位置情報を使ってマーカーを作成
                            const marker = new google.maps.Marker({
                                position: loc.location,  // ジオコードされた位置情報
                                map: map,
                                label: markerData.label,
                                title: markerData.title,
                                icon: markerData.icon
                            });
                        });
                        
                        // ルートの計算と表示
                        if (locations.length > 1) {
                            const origin = locations[0].location;
                            const destination = locations[locations.length - 1].location;
                            
                            // 始点と終点以外のウェイポイント
                            const waypointsForRoute = locations.slice(1, locations.length - 1).map(loc => ({
                                location: loc.location,
                                stopover: true
                            }));
                            
                            directionsService.route(
                                {
                                    origin: origin,
                                    destination: destination,
                                    waypoints: waypointsForRoute,
                                    optimizeWaypoints: false,
                                    travelMode: google.maps.TravelMode.DRIVING,
                                },
                                (response, status) => {
                                    if (status === "OK") {
                                        directionsRenderer.setDirections(response);
                                    } else {
                                        window.alert("ルートの取得に失敗しました: " + status);
                                    }
                                }
                            );
                        }
                    }).catch(error => {
                        console.error('Error in geocoding promises:', error);
                    });
                }
            </script>
            <script async defer
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCTFoakBSQGcGC9spRGflV8gZEV2lJb2Bc&callback=initMap">
            </script>
        </body>
        </html>
        